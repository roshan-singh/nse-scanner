<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NSE Scanners Suite</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            padding: 10px;
            min-height: 100vh;
        }

        .container { max-width: 1200px; margin: 0 auto; }

        /* â”€â”€ Main Header â”€â”€ */
        .main-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: 15px 15px 0 0;
        }
        .main-header h1 { font-size: 2em; margin-bottom: 5px; }
        .main-header p { font-size: 0.9em; opacity: 0.9; }

        /* â”€â”€ Scanner Tabs â”€â”€ */
        .scanner-tabs {
            display: flex;
            background: #1e2a3a;
            border-bottom: 2px solid #667eea;
        }
        .scanner-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            color: #aaa;
            cursor: pointer;
            font-size: 0.95em;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }
        .scanner-tab.active {
            color: #667eea;
            border-bottom: 3px solid #667eea;
            background: #243044;
        }
        .scanner-tab:hover { background: #243044; }

        /* â”€â”€ Scanner Container â”€â”€ */
        .scanner-container { display: none; background: #f5f7fa; }
        .scanner-container.active { display: block; }

        /* â”€â”€ Section Tabs (Latest/History) â”€â”€ */
        .section-tabs {
            display: flex;
            background: #e0e6f0;
        }
        .section-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            color: #666;
            cursor: pointer;
            font-size: 0.88em;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }
        .section-tab.active {
            color: #667eea;
            border-bottom: 2px solid #667eea;
            background: white;
        }

        .section-content { display: none; background: #fff; }
        .section-content.active { display: block; }

        /* â”€â”€ Stats Bar â”€â”€ */
        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            padding: 12px;
            background: #f0f2f5;
            gap: 8px;
        }
        @media(min-width: 500px) {
            .stats { grid-template-columns: repeat(4, 1fr); }
        }
        .stat-box {
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            text-align: center;
        }
        .stat-box .label { font-size: 0.7em; color: #888; margin-bottom: 3px; }
        .stat-box .value { font-size: 1.1em; font-weight: bold; color: #667eea; }

        /* â”€â”€ Schedule Info â”€â”€ */
        .schedule-info {
            background: #e8f4fd;
            border-left: 4px solid #667eea;
            padding: 10px 15px;
            margin: 10px;
            border-radius: 4px;
            font-size: 0.82em;
            color: #444;
        }
        .schedule-info strong { color: #667eea; }

        /* â”€â”€ Buttons â”€â”€ */
        .btn-row {
            display: flex;
            gap: 10px;
            padding: 10px 15px;
            flex-wrap: wrap;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 22px;
            font-size: 0.95em;
            border-radius: 25px;
            cursor: pointer;
            box-shadow: 0 3px 10px rgba(0,0,0,0.15);
            transition: transform 0.15s;
        }
        button:active { transform: scale(0.97); }
        button:disabled { opacity: 0.55; cursor: not-allowed; }
        .btn-green { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }
        .btn-orange { background: linear-gradient(135deg, #f7971e 0%, #ffd200 100%); color: #333; }
        .btn-sm { padding: 6px 14px; font-size: 0.78em; border-radius: 20px; }

        /* â”€â”€ Tables â”€â”€ */
        .table-wrapper { padding: 10px 15px 15px; overflow-x: auto; }
        .table-title {
            font-size: 1em;
            font-weight: bold;
            margin-bottom: 8px;
            padding: 9px 12px;
            border-radius: 7px;
            text-align: center;
            color: white;
        }
        .bullish-title { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }
        .bearish-title { background: linear-gradient(135deg, #ee0979 0%, #ff6a00 100%); }
        .losers-title { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-radius: 8px;
            overflow: hidden;
            font-size: 0.85em;
            margin-bottom: 18px;
        }
        thead { background: #667eea; color: white; }
        th, td { padding: 9px 10px; text-align: left; }
        tbody tr:nth-child(even) { background: #f7f9fc; }
        tbody tr:hover { background: #eef1fa; }

        /* â”€â”€ History List â”€â”€ */
        .history-list { padding: 10px 15px; }
        .history-card {
            background: #f7f9fc;
            border: 1px solid #e0e6f0;
            border-radius: 10px;
            padding: 12px 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 8px;
        }
        .history-card:hover { background: #eef1fa; }
        .history-meta { font-size: 0.82em; color: #555; }
        .history-meta strong { color: #333; font-size: 0.95em; }
        .history-actions { display: flex; gap: 8px; flex-wrap: wrap; }

        /* â”€â”€ Loading / Error â”€â”€ */
        .loading, .error, .empty-state {
            text-align: center;
            padding: 40px 20px;
            font-size: 0.95em;
        }
        .loading { color: #667eea; }
        .error { color: #dc3545; }
        .empty-state { color: #888; }
        
        .spinner {
            border: 3px solid #e0e6f0;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 38px; height: 38px;
            animation: spin 0.9s linear infinite;
            margin: 0 auto 15px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .badge {
            display: inline-block;
            background: #667eea;
            color: white;
            border-radius: 10px;
            padding: 2px 8px;
            font-size: 0.75em;
            margin-left: 5px;
        }

        /* â”€â”€ Footer â”€â”€ */
        .footer {
            background: #1e2a3a;
            color: #aaa;
            text-align: center;
            padding: 12px;
            font-size: 0.78em;
            border-radius: 0 0 15px 15px;
        }
        .footer span { color: #667eea; }
    </style>
</head>
<body>
<div class="container">

    <!-- Main Header -->
    <div class="main-header">
        <h1>ğŸ“Š NSE Scanners Suite</h1>
        <p>Dual Scanner System â€¢ Auto-scheduled â€¢ Results Saved</p>
    </div>

    <!-- Scanner Tabs -->
    <div class="scanner-tabs">
        <div class="scanner-tab active" onclick="switchScanner('fno')">ğŸ“ˆ FnO Options Scanner</div>
        <div class="scanner-tab" onclick="switchScanner('losers')">ğŸ“‰ Top Losers OH</div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- FnO OPTIONS SCANNER -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="scanner-fno" class="scanner-container active">
        
        <!-- Section Tabs -->
        <div class="section-tabs">
            <div class="section-tab active" onclick="switchSection('fno', 'latest')">ğŸ“ˆ Latest Scan</div>
            <div class="section-tab" onclick="switchSection('fno', 'history')">ğŸ• History</div>
        </div>

        <!-- Latest Section -->
        <div id="fno-section-latest" class="section-content active">
            <div class="schedule-info">
                â° <strong>Auto-scan times (IST, Monâ€“Fri):</strong>
                09:17 | 09:18 | 09:19 | 09:20 | 09:21
            </div>
            <div class="btn-row">
                <button onclick="manualScan('fno')" id="fno-scan-btn">ğŸš€ Manual Scan</button>
                <button class="btn-green" onclick="loadLatest('fno')" id="fno-refresh-btn">ğŸ”„ Load Latest</button>
            </div>
            <div id="fno-stats" class="stats" style="display:none;"></div>
            <div id="fno-latest-content">
                <div class="empty-state">Click <strong>Load Latest</strong> or <strong>Manual Scan</strong></div>
            </div>
        </div>

        <!-- History Section -->
        <div id="fno-section-history" class="section-content">
            <div class="btn-row">
                <button onclick="loadHistory('fno')" class="btn-green">ğŸ”„ Refresh History</button>
                <button onclick="downloadAllCSV('fno')" class="btn-orange">â¬‡ï¸ Download All (CSV)</button>
            </div>
            <div id="fno-history-content">
                <div class="empty-state">Click Refresh History</div>
            </div>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- TOP LOSERS OH SCANNER -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="scanner-losers" class="scanner-container">
        
        <!-- Section Tabs -->
        <div class="section-tabs">
            <div class="section-tab active" onclick="switchSection('losers', 'latest')">ğŸ“ˆ Latest Scan</div>
            <div class="section-tab" onclick="switchSection('losers', 'history')">ğŸ• History</div>
        </div>

        <!-- Latest Section -->
        <div id="losers-section-latest" class="section-content active">
            <div class="schedule-info">
                â° <strong>Auto-scan time (IST, Monâ€“Fri):</strong> 09:31 ONLY
            </div>
            <div class="btn-row">
                <button onclick="manualScan('losers')" id="losers-scan-btn">ğŸš€ Manual Scan</button>
                <button class="btn-green" onclick="loadLatest('losers')" id="losers-refresh-btn">ğŸ”„ Load Latest</button>
            </div>
            <div id="losers-stats" class="stats" style="display:none;"></div>
            <div id="losers-latest-content">
                <div class="empty-state">Click <strong>Load Latest</strong> or <strong>Manual Scan</strong></div>
            </div>
        </div>

        <!-- History Section -->
        <div id="losers-section-history" class="section-content">
            <div class="btn-row">
                <button onclick="loadHistory('losers')" class="btn-green">ğŸ”„ Refresh History</button>
                <button onclick="downloadAllCSV('losers')" class="btn-orange">â¬‡ï¸ Download All (CSV)</button>
            </div>
            <div id="losers-history-content">
                <div class="empty-state">Click Refresh History</div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        Auto-scheduled scans run <span>Monâ€“Fri</span> â€¢ 
        FnO: 09:17-09:21 (5 scans) â€¢ 
        Losers OH: 09:31 only â€¢ 
        Last 30 scans saved per scanner
    </div>

</div>

<script>
    let isScanning = { fno: false, losers: false };

    // â”€â”€ Scanner Switching â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function switchScanner(scanner) {
        document.querySelectorAll('.scanner-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.scanner-container').forEach(t => t.classList.remove('active'));
        document.querySelector(`.scanner-tab[onclick="switchScanner('${scanner}')"]`).classList.add('active');
        document.getElementById(`scanner-${scanner}`).classList.add('active');
    }

    // â”€â”€ Section Switching â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function switchSection(scanner, section) {
        const container = document.getElementById(`scanner-${scanner}`);
        container.querySelectorAll('.section-tab').forEach(t => t.classList.remove('active'));
        container.querySelectorAll('.section-content').forEach(t => t.classList.remove('active'));
        container.querySelector(`.section-tab[onclick="switchSection('${scanner}', '${section}')"]`).classList.add('active');
        container.querySelector(`#${scanner}-section-${section}`).classList.add('active');

        if (section === 'history') loadHistory(scanner);
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // FNO OPTIONS SCANNER FUNCTIONS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    function renderFnoTables(data, container) {
        const dlBtn = data.id ? `<button class="btn-orange btn-sm" onclick="downloadCSV('fno', '${data.id}')">â¬‡ï¸ CSV</button>` : '';
        container.innerHTML = `
            <div style="padding:8px 15px; font-size:0.8em; color:#666; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:6px;">
                <span>ğŸ• ${data.scanTimestamp} | ğŸ“… Expiry: <strong>${data.expiry}</strong></span>
                ${dlBtn}
            </div>
            <div class="table-wrapper">
                <div class="table-title bullish-title">ğŸ‚ TOP 10 BULLISH</div>
                <table>
                    <thead><tr><th>#</th><th>Symbol</th><th>CE_OL</th><th>PE_OH</th></tr></thead>
                    <tbody>
                        ${data.bullish.length > 0
                            ? data.bullish.map((s, i) => `<tr><td>${i + 1}</td><td><strong>${s.symbol}</strong></td><td>${s.ceOL}</td><td>${s.peOH}</td></tr>`).join('')
                            : '<tr><td colspan="4" style="text-align:center;color:#aaa;">No data</td></tr>'
                        }
                    </tbody>
                </table>
                <div class="table-title bearish-title">ğŸ» TOP 10 BEARISH</div>
                <table>
                    <thead><tr><th>#</th><th>Symbol</th><th>PE_OL</th><th>CE_OH</th></tr></thead>
                    <tbody>
                        ${data.bearish.length > 0
                            ? data.bearish.map((s, i) => `<tr><td>${i + 1}</td><td><strong>${s.symbol}</strong></td><td>${s.peOL}</td><td>${s.ceOH}</td></tr>`).join('')
                            : '<tr><td colspan="4" style="text-align:center;color:#aaa;">No data</td></tr>'
                        }
                    </tbody>
                </table>
            </div>
        `;
    }

    function updateFnoStats(data) {
        document.getElementById('fno-stats').innerHTML = `
            <div class="stat-box"><div class="label">Total Symbols</div><div class="value">${data.totalSymbols}</div></div>
            <div class="stat-box"><div class="label">Scanned</div><div class="value">${data.totalScannedSuccessfully}</div></div>
            <div class="stat-box"><div class="label">Qualified</div><div class="value">${data.stocksMeetingConditions}</div></div>
            <div class="stat-box"><div class="label">Time</div><div class="value">${data.scanTime}s</div></div>
        `;
        document.getElementById('fno-stats').style.display = 'grid';
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // LOSERS OH SCANNER FUNCTIONS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    function renderLosersTable(data, container) {
        const dlBtn = data.id ? `<button class="btn-orange btn-sm" onclick="downloadCSV('losers', '${data.id}')">â¬‡ï¸ CSV</button>` : '';
        container.innerHTML = `
            <div style="padding:8px 15px; font-size:0.8em; color:#666; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:6px;">
                <span>ğŸ• ${data.scanTimestamp}</span>
                ${dlBtn}
            </div>
            <div class="table-wrapper">
                <div class="table-title losers-title">ğŸ“‰ EQ STOCKS WITH OPEN = HIGH</div>
                <table>
                    <thead><tr><th>#</th><th>Symbol</th><th>Open</th><th>High</th><th>Low</th><th>LTP</th><th>Change %</th><th>Volume</th></tr></thead>
                    <tbody>
                        ${data.stocks.length > 0
                            ? data.stocks.map((s, i) => `
                                <tr>
                                    <td>${i + 1}</td>
                                    <td><strong>${s.symbol}</strong></td>
                                    <td>${s.open.toFixed(2)}</td>
                                    <td>${s.high.toFixed(2)}</td>
                                    <td>${s.low.toFixed(2)}</td>
                                    <td>${s.ltp.toFixed(2)}</td>
                                    <td>${s.change.toFixed(2)}%</td>
                                    <td>${s.volume.toLocaleString()}</td>
                                </tr>`).join('')
                            : '<tr><td colspan="8" style="text-align:center;color:#aaa;">No qualifying stocks</td></tr>'
                        }
                    </tbody>
                </table>
            </div>
        `;
    }

    function updateLosersStats(data) {
        document.getElementById('losers-stats').innerHTML = `
            <div class="stat-box"><div class="label">Total FOSec</div><div class="value">${data.totalFOSecStocks}</div></div>
            <div class="stat-box"><div class="label">Qualified</div><div class="value">${data.qualifiedStocks}</div></div>
            <div class="stat-box"><div class="label">Scan Time</div><div class="value">${data.scanTime}s</div></div>
        `;
        document.getElementById('losers-stats').style.display = 'grid';
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // COMMON FUNCTIONS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    async function loadLatest(scanner) {
        const content = document.getElementById(`${scanner}-latest-content`);
        const btn = document.getElementById(`${scanner}-refresh-btn`);
        btn.disabled = true;
        content.innerHTML = '<div class="loading"><div class="spinner"></div>Loading latest scan...</div>';

        try {
            const res = await fetch(`/api/${scanner}/results/latest`);
            const data = await res.json();
            if (!data) {
                content.innerHTML = '<div class="empty-state">No scans yet.</div>';
                document.getElementById(`${scanner}-stats`).style.display = 'none';
            } else {
                if (scanner === 'fno') {
                    updateFnoStats(data);
                    renderFnoTables(data, content);
                } else {
                    updateLosersStats(data);
                    renderLosersTable(data, content);
                }
            }
        } catch (err) {
            content.innerHTML = `<div class="error">âŒ ${err.message}</div>`;
        } finally {
            btn.disabled = false;
        }
    }

    async function manualScan(scanner) {
        if (isScanning[scanner]) return;
        isScanning[scanner] = true;

        const content = document.getElementById(`${scanner}-latest-content`);
        const btn = document.getElementById(`${scanner}-scan-btn`);
        btn.disabled = true;
        content.innerHTML = '<div class="loading"><div class="spinner"></div>Scanning... This takes 1â€“2 minutes.</div>';
        document.getElementById(`${scanner}-stats`).style.display = 'none';

        try {
            const res = await fetch(`/api/${scanner}/scan`);
            if (!res.ok) throw new Error(`Server error ${res.status}`);
            const data = await res.json();
            
            if (scanner === 'fno') {
                updateFnoStats(data);
                renderFnoTables(data, content);
            } else {
                updateLosersStats(data);
                renderLosersTable(data, content);
            }
        } catch (err) {
            content.innerHTML = `<div class="error">âŒ ${err.message}<br><br>Make sure the server is running.</div>`;
        } finally {
            isScanning[scanner] = false;
            btn.disabled = false;
        }
    }

    async function loadHistory(scanner) {
        const content = document.getElementById(`${scanner}-history-content`);
        content.innerHTML = '<div class="loading"><div class="spinner"></div>Loading history...</div>';

        try {
            const res = await fetch(`/api/${scanner}/results`);
            const results = await res.json();

            if (!results || results.length === 0) {
                content.innerHTML = '<div class="empty-state">No scan history yet.</div>';
                return;
            }

            const html = results.map((r, idx) => {
                const meta = scanner === 'fno'
                    ? `ğŸ“… ${r.expiry} | âœ… ${r.stocksMeetingConditions} qualified | â± ${r.scanTime}s`
                    : `âœ… ${r.qualifiedStocks} qualified | â± ${r.scanTime}s`;

                return `
                    <div class="history-card">
                        <div class="history-meta">
                            <strong>${r.scanTimestamp}</strong>
                            ${idx === 0 ? '<span class="badge">Latest</span>' : ''}
                            <br>${meta}
                        </div>
                        <div class="history-actions">
                            <button class="btn-sm" onclick="viewHistoryScan('${scanner}', ${r.id})">ğŸ‘ View</button>
                            <button class="btn-sm btn-orange" onclick="downloadCSV('${scanner}', '${r.id}')">â¬‡ï¸ CSV</button>
                        </div>
                    </div>
                `;
            }).join('');

            content.innerHTML = `<div class="history-list">${html}</div>`;
        } catch (err) {
            content.innerHTML = `<div class="error">âŒ ${err.message}</div>`;
        }
    }

    async function viewHistoryScan(scanner, id) {
        switchSection(scanner, 'latest');
        const content = document.getElementById(`${scanner}-latest-content`);
        content.innerHTML = '<div class="loading"><div class="spinner"></div>Loading scan...</div>';

        try {
            const res = await fetch(`/api/${scanner}/results`);
            const results = await res.json();
            const data = results.find(r => r.id === id);
            if (!data) throw new Error('Scan not found');
            
            if (scanner === 'fno') {
                updateFnoStats(data);
                renderFnoTables(data, content);
            } else {
                updateLosersStats(data);
                renderLosersTable(data, content);
            }
        } catch (err) {
            content.innerHTML = `<div class="error">âŒ ${err.message}</div>`;
        }
    }

    function downloadCSV(scanner, id) {
        window.location.href = `/api/${scanner}/download/csv/${id}`;
    }

    function downloadAllCSV(scanner) {
        window.location.href = `/api/${scanner}/download/csv/all`;
    }

    // Auto-load latest on page load
    window.addEventListener('load', () => {
        loadLatest('fno');
    });
</script>
</body>
</html>
